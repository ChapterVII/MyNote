# 埋点

> 所谓埋点就是在应用中特定的流程收集一些信息，用来跟踪应用使用的状况，后续用来进一步优化产品或是提供运营的数据支撑，包括访问（Visits），访客（Visitor），停留时间（Time On Site），页面查看（Page Views，又称为页面浏览）和跳出率（Bounce Rate，又可称为蹦失率）。这样的信息收集可以大致分为两种：页面统计（track this virtual page view），统计操作行为（track this button by an event）。

## 数据埋点方式

1. 研发在产品中注入代码统计，并搭建起相应的后台查询。
2. 第三方统计工具，如友盟、神策、Talkingdata、GrowingIO等。

产品早期通常会使用第二种方式，并直接使用第三方工具分析。

对于对数据安全比较重视，业务相对复杂的公司通常使用第一种方式，并搭建相应的数据产品实现数据应用或是分析的诉求。

## 关键指标

### 访问与访客——最基础的指标

访问：是指会话层，用户打卡应用浏览一段时间后离开，又称为统计会话数。一次会话是打开应用的第一个请求和最后一个请求决定的。如果打开后30分钟（早期网页版应用约定俗成的会话数定义）没任何动作，此次会话自动结束，通常也算作一次访问或会话期

访客：埋点上报的数据尽可能接近真实访客的人数。对于需要统计独立访客指标的场景，访问人数并不是真实独立的人，因此收集数据时必须知道访问人数虽然能很好的反应使用应用的真是访问者的数量，但并不等于使用应用的真实人数。原因是，计算访问人数的埋点依赖Cookie。

### 停留时长

衡量用户在应用的某个页面或一次访问（会话）所停留的时间。

停留时长的数据并不一定都采集的到，如离开出现异常或是退出时间没有记录，就是0。

### 跳出率

计算方法最常被使用的是：用户只访问了一个页面所占的会话比例，原因是用户来了访问了一个页面就离开了的场景很可怕。

分解：

- 整个应用的跳出率
- 重点的着陆页的跳出率，甚至是搜索关键词的跳出率。

### 退出率

针对某个页面有多少用户离开了应用，主要用于反映用户从应用离开的情况，发掘哪些页面需要被改进。

退出率搞不一定是坏事。

### 转化率

计算方法：某种产出/独立访客或访问量，对于电商产品就是提交订单用户/独立访客

埋点中最贴近业务的数据收集，也是体现埋点技巧的指标，需要结和业务指定计算方法。

还可以分层次，指定用户路径的，如：完成某条路径的提交订单数/访客数。

### 参与度

一系列指标的统称，如：访问深度、访问频次、针对电商的下单数、针对内容服务商的播放次数、用户行为序列。

## 埋点的内容

- 统计页面访问情况，即页面统计，随页面访问动作发生时进行上报
- 统计应用内的操作行为，在页面中操作时进行上报，如组件点击时、上滑下滑时

为了统计到需要的指标，应用中所有页面，事件都被唯一标记，用户的信息、设备的信息、时间参数以及符合业务需要的参数具体内容被附加上报，就是埋点。

## 前端埋点

1. 代码埋点

   以嵌入代码的形式进行埋点，如需监控用户的点击事件，会选择在用户点击时插入一段代码，保存这个监听行为或直接将监听行为以某种数据格式传递给server端。此外，如需统计产品的PV（页面浏览量或点击量）和UV（访问某个站点或点击某条新闻的不同IP地址的人数）的时候，需要在网页的初始化时发送用户的访问信息等。

   优点：可以在任意时刻，精确的发送或保存所需要的数据信息。

   缺点：工作量较大，每个组件的埋点都需要添加相应的代码。

2. 可视化埋点

   通过可视化交互的手段，代替代码埋点。将业务代码和埋点代码分离，提供一个可视化交互的页面，可以在业务代码中自定义增加埋点时间等。就是用一个系统实现手动插入代码埋点的过程。

   缺点：可以埋点的控件有限，不能手动定制。

3. 无埋点

   不是不需要埋点，而是全部埋点。前端的任意一个时间都被绑定一个标识，所有的时间都记录下来。通过定期上传记录文件，配合文件解析，并生成可视化报告供专业人员分析。

   如从页面的js代码中，找出dom上被绑定的事件，进行全埋点。

   优点：产品迭代过程中不需要关注埋点逻辑，也不会出现漏埋、误埋。

   缺点：采集全量数据，给数据传输和服务器增加压力；无法灵活的定制各个事件所需要上传的数据。

## 注意事项

不要过分追求完美



## 参考资源

<https://zhuanlan.zhihu.com/p/25195217>

<https://juejin.im/post/5b62d68df265da0f9d1a1cd6>

